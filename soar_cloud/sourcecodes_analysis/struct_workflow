è¿™ä¸ª workflow é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Django æ¡†æ¶çš„ Python åç«¯æœåŠ¡ï¼Œä¸»è¦ç”¨äº å·¥ä½œæµå¼•æ“ å’Œ ä»»åŠ¡è°ƒåº¦ï¼ˆå¦‚ schedulersã€tasks æ¨¡å—ï¼‰ã€‚ä»ç›®å½•ç»“æ„æ¥çœ‹ï¼Œå®ƒé‡‡ç”¨äº† å¾®æœåŠ¡ + æ¨¡å—åŒ– çš„è®¾è®¡é£æ ¼ï¼ŒåŒæ—¶æ•´åˆäº† Celeryï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰ã€RabbitMQï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€Ansibleï¼ˆè‡ªåŠ¨åŒ–ï¼‰ç­‰æŠ€æœ¯ã€‚

1. é¡¹ç›®æ•´ä½“æ¶æ„
1.1 æ ¸å¿ƒæ¨¡å—
æ¨¡å—	åŠŸèƒ½
sealab/	Django ä¸»åº”ç”¨ï¼ŒåŒ…å«æ ¸å¿ƒé…ç½®ï¼ˆsettings.pyã€wsgi.pyï¼‰
workflow/	å·¥ä½œæµå¼•æ“æ ¸å¿ƒé€»è¾‘ï¼ˆä»»åŠ¡è°ƒåº¦ã€è§¦å‘å™¨ã€è§„åˆ™å¼•æ“ç­‰ï¼‰
rules_engine/	è§„åˆ™å¼•æ“ï¼ˆaction_handlersã€queryFilterã€notification_listenerï¼‰
tasks/	å¼‚æ­¥ä»»åŠ¡ç®¡ç†ï¼ˆcelery.pyã€scheduler.pyï¼‰
auth_ogre/	æƒé™ç®¡ç†ï¼ˆpermissions.pyã€models.pyï¼‰
porter/	æ•°æ®å¯¼å…¥å¯¼å‡ºï¼ˆdataconfig.pyã€tasks.pyï¼‰
postman/	API è¯·æ±‚ç®¡ç†ï¼ˆcallbacksã€coreï¼‰
policy/	ç­–ç•¥ç®¡ç†ï¼ˆserializers.pyã€views.pyï¼‰
tenant/	å¤šç§Ÿæˆ·æ”¯æŒï¼ˆmodels.pyã€utils.pyï¼‰
1.2 éƒ¨ç½² & è¿ç»´
ç›®å½•/æ–‡ä»¶	ç”¨é€”
deployment/	æ„å»º & è¿è¡Œè„šæœ¬ï¼ˆbuild.shã€run.shï¼‰
Dockerfile*	å¤šå®¹å™¨éƒ¨ç½²ï¼ˆWorkflowExecEnvWorkflowã€WorkflowSchedulerï¼‰
package.d/	è¿è¡Œæ—¶é…ç½®ï¼ˆgunicorn.conf.pyã€requirements.txtï¼‰
sealab_wsgi.ini	uWSGI é…ç½®
sealab.log	æ—¥å¿—æ–‡ä»¶
2. å…³é”®æŠ€æœ¯æ ˆ
2.1 æ ¸å¿ƒæ¡†æ¶

    Djangoï¼ˆmanage.pyã€settings.pyï¼‰

    Django REST Frameworkï¼ˆserializers.pyã€views.pyï¼‰

    Celeryï¼ˆcelery.pyã€tasks/ï¼‰

    RabbitMQï¼ˆrabbitmq_utils.pyï¼‰

2.2 æ•°æ®åº“ & ORM

    PostgreSQL/MySQLï¼ˆmodels.pyã€migrations/ï¼‰

    Django Tenantï¼ˆtenant/ å¤šç§Ÿæˆ·æ”¯æŒï¼‰

2.3 å…¶ä»–å…³é”®æŠ€æœ¯

    Ansibleï¼ˆansible_filters/ ç”¨äº Jinja2 æ¨¡æ¿è¿‡æ»¤ï¼‰

    Cythonï¼ˆcythonize.py å¯èƒ½ç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼‰

    Jinja2ï¼ˆjinja.py ç”¨äºåŠ¨æ€æ¨¡æ¿æ¸²æŸ“ï¼‰

    Redisï¼ˆdjango_cache/ ç¼“å­˜ç®¡ç†ï¼‰

3. å…³é”®åŠŸèƒ½åˆ†æ
3.1 å·¥ä½œæµå¼•æ“ï¼ˆworkflow/ï¼‰

    schedulers/ï¼šä»»åŠ¡è°ƒåº¦ï¼ˆç±»ä¼¼ Airflow/Celery Beatï¼‰

    triggers/ï¼šäº‹ä»¶è§¦å‘æœºåˆ¶ï¼ˆå¦‚ Webhookã€å®šæ—¶ä»»åŠ¡ï¼‰

    builtins/ï¼šå†…ç½®å·¥ä½œæµå‡½æ•°

    eval.pyï¼šåŠ¨æ€æ‰§è¡Œ Python ä»£ç ï¼ˆå¯èƒ½ç”¨äºè‡ªå®šä¹‰é€»è¾‘ï¼‰

    rabbitmq_utils.pyï¼šæ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡

3.2 è§„åˆ™å¼•æ“ï¼ˆrules_engine/ï¼‰

    action_handlers/ï¼šè§„åˆ™è§¦å‘åçš„åŠ¨ä½œï¼ˆå¦‚å‘é‚®ä»¶ã€è°ƒç”¨ APIï¼‰

    queryFilter.pyï¼šæ•°æ®è¿‡æ»¤ï¼ˆç±»ä¼¼ Django Q å¯¹è±¡ï¼‰

    notification_listener.pyï¼šç›‘å¬äº‹ä»¶å¹¶è§¦å‘è§„åˆ™

3.3 å¤šç§Ÿæˆ·ï¼ˆtenant/ï¼‰

    models.pyï¼šç§Ÿæˆ·æ•°æ®æ¨¡å‹

    management/ï¼šDjango è‡ªå®šä¹‰å‘½ä»¤ï¼ˆå¦‚ python manage.py tenant_createï¼‰

    utils.pyï¼šç§Ÿæˆ·éš”ç¦»é€»è¾‘

4. å¯èƒ½çš„ä¼˜åŒ–ç‚¹

    å®¹å™¨åŒ–æ”¹è¿›ï¼š

        å½“å‰æœ‰å¤šä¸ª Dockerfileï¼Œå¯è€ƒè™‘ç”¨ docker-compose.yml ç®¡ç†å¤šä¸ªæœåŠ¡ã€‚

    æ—¥å¿—ç®¡ç†ï¼š

        sealab.log æ˜¯å•ä¸€æ–‡ä»¶ï¼Œå¯æ”¹ç”¨ logging.conf æˆ– ELK é›†ä¸­ç®¡ç†ã€‚

    æµ‹è¯•è¦†ç›–ï¼š

        éƒ¨åˆ†æ¨¡å—ï¼ˆå¦‚ rules_engine/tests.pyï¼‰æœ‰æµ‹è¯•ï¼Œä½†å¯å¢åŠ å•å…ƒæµ‹è¯•è¦†ç›–ç‡ã€‚

    æ€§èƒ½ä¼˜åŒ–ï¼š

        cythonize.py å¯èƒ½ç”¨äºåŠ é€Ÿå…³é”®ä»£ç ï¼Œå¯è¯„ä¼°æ˜¯å¦å€¼å¾—æ‰©å±•ã€‚

5. æ€»ç»“

    è¿™æ˜¯ä¸€ä¸ªä¼ä¸šçº§å·¥ä½œæµå¼•æ“ï¼Œæ”¯æŒ å¤šç§Ÿæˆ·ã€è§„åˆ™å¼•æ“ã€ä»»åŠ¡è°ƒåº¦ã€æ¶ˆæ¯é˜Ÿåˆ—ã€‚

    æŠ€æœ¯æ ˆæˆç†Ÿï¼ˆDjango + Celery + RabbitMQ + Ansibleï¼‰ã€‚

    é€‚åˆè‡ªåŠ¨åŒ–è¿ç»´ã€å®‰å…¨ç¼–æ’ï¼ˆSOARï¼‰ã€ä»»åŠ¡è°ƒåº¦ç­‰åœºæ™¯ã€‚

    å¯æ‰©å±•æ€§é«˜ï¼Œä½†éœ€æ³¨æ„å¤šç§Ÿæˆ·éš”ç¦»å’Œæ€§èƒ½ä¼˜åŒ–ã€‚

å¦‚æœæœ‰æ›´å…·ä½“çš„éœ€æ±‚ï¼ˆå¦‚æŸä¸ªæ¨¡å—çš„è¯¦ç»†åˆ†æï¼‰ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ¢è®¨ï¼ ğŸš€

tree -L 3
.
â”œâ”€â”€ deployment
â”‚Â Â  â”œâ”€â”€ build-workflow-execenv-workflow-tenant.sh
â”‚Â Â  â”œâ”€â”€ build-workflow-execenv-workflow.sh
â”‚Â Â  â”œâ”€â”€ build-workflow-scheduler.sh
â”‚Â Â  â”œâ”€â”€ build.sh
â”‚Â Â  â””â”€â”€ run.sh
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Dockerfile-WorkflowExecEnvWorkflow
â”œâ”€â”€ Dockerfile-WorkflowScheduler
â””â”€â”€ sealab
    â”œâ”€â”€ ansible_filters
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â””â”€â”€ jinja.py
    â”œâ”€â”€ auth_ogre
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ enums.py
    â”‚Â Â  â”œâ”€â”€ migrations
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ permissions.py
    â”‚Â Â  â”œâ”€â”€ requests_auth.py
    â”‚Â Â  â”œâ”€â”€ schemes.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ configs
    â”‚Â Â  â”œâ”€â”€ default
    â”‚Â Â  â”œâ”€â”€ dev
    â”‚Â Â  â”œâ”€â”€ prod
    â”‚Â Â  â””â”€â”€ qa
    â”œâ”€â”€ crud
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ apps.py
    â”‚Â Â  â”œâ”€â”€ data_fixtures
    â”‚Â Â  â”œâ”€â”€ error_message.py
    â”‚Â Â  â”œâ”€â”€ fixtures
    â”‚Â Â  â”œâ”€â”€ locale
    â”‚Â Â  â”œâ”€â”€ managers.py
    â”‚Â Â  â”œâ”€â”€ migrations
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ serializers.py
    â”‚Â Â  â”œâ”€â”€ tests.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â”œâ”€â”€ utils.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ cythonize.py
    â”œâ”€â”€ django_cache
    â”‚Â Â  â””â”€â”€ __init__.py
    â”œâ”€â”€ expression_builder
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ apps.py
    â”‚Â Â  â”œâ”€â”€ custom
    â”‚Â Â  â”œâ”€â”€ exp.py
    â”‚Â Â  â”œâ”€â”€ expressions
    â”‚Â Â  â”œâ”€â”€ jinja.py
    â”‚Â Â  â”œâ”€â”€ migrations
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ tests.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ global_variable
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ apps.py
    â”‚Â Â  â”œâ”€â”€ fixtures
    â”‚Â Â  â”œâ”€â”€ migrations
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ serializers.py
    â”‚Â Â  â”œâ”€â”€ tests.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ identity
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ apps.py
    â”‚Â Â  â”œâ”€â”€ fixtures
    â”‚Â Â  â”œâ”€â”€ manager.py
    â”‚Â Â  â”œâ”€â”€ migrations
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ tests.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ lerna
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ metadata.py
    â”‚Â Â  â”œâ”€â”€ migrations
    â”‚Â Â  â”œâ”€â”€ mixins.py
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ pagination.py
    â”‚Â Â  â”œâ”€â”€ routers.py
    â”‚Â Â  â”œâ”€â”€ tests
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ manage.py
    â”œâ”€â”€ middleware
    â”‚Â Â  â””â”€â”€ tenant_scoping_middleware.py
    â”œâ”€â”€ monitor
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â””â”€â”€ core.py
    â”œâ”€â”€ notifier
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â””â”€â”€ notifier.py
    â”œâ”€â”€ package.d
    â”‚Â Â  â”œâ”€â”€ boot.sh
    â”‚Â Â  â”œâ”€â”€ check_integration_status.sh
    â”‚Â Â  â”œâ”€â”€ gunicorn.conf.py
    â”‚Â Â  â”œâ”€â”€ requirements.txt
    â”‚Â Â  â”œâ”€â”€ server-cert-chained.pem
    â”‚Â Â  â”œâ”€â”€ server-key.pem
    â”‚Â Â  â”œâ”€â”€ setup.sh
    â”‚Â Â  â”œâ”€â”€ workflow_execenv_workflow_boot.sh
    â”‚Â Â  â””â”€â”€ workflow_scheduler_boot.sh
    â”œâ”€â”€ pod6
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ apps.py
    â”‚Â Â  â”œâ”€â”€ migrations
    â”‚Â Â  â”œâ”€â”€ mixins.py
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â””â”€â”€ tests.py
    â”œâ”€â”€ policy
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ serializers.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ porter
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ apps.py
    â”‚Â Â  â”œâ”€â”€ dataconfig.py
    â”‚Â Â  â”œâ”€â”€ errors.py
    â”‚Â Â  â”œâ”€â”€ migrations
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ serializers.py
    â”‚Â Â  â”œâ”€â”€ tasks.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â”œâ”€â”€ utils.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ postman
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ apps.py
    â”‚Â Â  â”œâ”€â”€ callbacks
    â”‚Â Â  â”œâ”€â”€ core
    â”‚Â Â  â”œâ”€â”€ migrations
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ tests.py
    â”‚Â Â  â”œâ”€â”€ utils
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ query
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ serializers.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ rulegin
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â””â”€â”€ queryobject.py
    â”œâ”€â”€ rules_engine
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ action_handlers
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ apps.py
    â”‚Â Â  â”œâ”€â”€ callbacks
    â”‚Â Â  â”œâ”€â”€ constants.py
    â”‚Â Â  â”œâ”€â”€ fixtures
    â”‚Â Â  â”œâ”€â”€ handler.py
    â”‚Â Â  â”œâ”€â”€ migrations
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ notification_listener.py
    â”‚Â Â  â”œâ”€â”€ query_filter_utility.py
    â”‚Â Â  â”œâ”€â”€ queryFilter.py
    â”‚Â Â  â”œâ”€â”€ rule_query_filter.py
    â”‚Â Â  â”œâ”€â”€ serializers.py
    â”‚Â Â  â”œâ”€â”€ tests.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â”œâ”€â”€ utility.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ sealab
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ celery_signals.py
    â”‚Â Â  â”œâ”€â”€ celery.py
    â”‚Â Â  â”œâ”€â”€ jinja.py
    â”‚Â Â  â”œâ”€â”€ settings.py
    â”‚Â Â  â”œâ”€â”€ tests.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â”œâ”€â”€ utils.py
    â”‚Â Â  â”œâ”€â”€ uwsgi_params
    â”‚Â Â  â””â”€â”€ wsgi.py
    â”œâ”€â”€ sealab_wsgi.ini
    â”œâ”€â”€ sealab.log
    â”œâ”€â”€ service_context
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ cache_constants.py
    â”‚Â Â  â”œâ”€â”€ consts.py
    â”‚Â Â  â”œâ”€â”€ core.py
    â”‚Â Â  â”œâ”€â”€ license.py
    â”‚Â Â  â””â”€â”€ service_context.py
    â”œâ”€â”€ tasks
    â”‚Â Â  â”œâ”€â”€ default_tasks.py
    â”‚Â Â  â”œâ”€â”€ defer_tasks.py
    â”‚Â Â  â”œâ”€â”€ main.py
    â”‚Â Â  â”œâ”€â”€ result.py
    â”‚Â Â  â”œâ”€â”€ scheduler.py
    â”‚Â Â  â””â”€â”€ utility.py
    â”œâ”€â”€ tenant
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ admin.py
    â”‚Â Â  â”œâ”€â”€ apps.py
    â”‚Â Â  â”œâ”€â”€ management
    â”‚Â Â  â”œâ”€â”€ migrations
    â”‚Â Â  â”œâ”€â”€ models.py
    â”‚Â Â  â”œâ”€â”€ serializers.py
    â”‚Â Â  â”œâ”€â”€ tests.py
    â”‚Â Â  â”œâ”€â”€ urls.py
    â”‚Â Â  â”œâ”€â”€ utils.py
    â”‚Â Â  â””â”€â”€ views.py
    â”œâ”€â”€ utility
    â”‚Â Â  â”œâ”€â”€ __init__.py
    â”‚Â Â  â”œâ”€â”€ config_parser.py
    â”‚Â Â  â”œâ”€â”€ cron.py
    â”‚Â Â  â”œâ”€â”€ profiler.py
    â”‚Â Â  â””â”€â”€ token.py
    â””â”€â”€ workflow
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ admin.py
        â”œâ”€â”€ all_default_schedulers.py
        â”œâ”€â”€ apps.py
        â”œâ”€â”€ audit_log_info.py
        â”œâ”€â”€ builtins
        â”œâ”€â”€ config
        â”œâ”€â”€ constants.py
        â”œâ”€â”€ contrib
        â”œâ”€â”€ encrypt_decrypt_util.py
        â”œâ”€â”€ enums.py
        â”œâ”€â”€ environment.py
        â”œâ”€â”€ errors
        â”œâ”€â”€ eval.py
        â”œâ”€â”€ exceptions.py
        â”œâ”€â”€ filters.py
        â”œâ”€â”€ filtersets.py
        â”œâ”€â”€ fixtures
        â”œâ”€â”€ func_legacy.py
        â”œâ”€â”€ helper.py
        â”œâ”€â”€ jinja.py
        â”œâ”€â”€ management
        â”œâ”€â”€ managers.py
        â”œâ”€â”€ migrations
        â”œâ”€â”€ models.py
        â”œâ”€â”€ np_filters.py
        â”œâ”€â”€ output_format.json
        â”œâ”€â”€ rabbitmq_utils.py
        â”œâ”€â”€ ratelimit
        â”œâ”€â”€ reader.py
        â”œâ”€â”€ schedulers
        â”œâ”€â”€ serializers.py
        â”œâ”€â”€ signals.py
        â”œâ”€â”€ tasks.py
        â”œâ”€â”€ triggers
        â”œâ”€â”€ urls.py
        â”œâ”€â”€ utility.py
        â””â”€â”€ views.py

